<?php
class sistemas_model extends CI_Model
{
var $is_logged_in;
    function __construct()
    {
        parent::__construct();
        $is_logged_in = $this->session->userdata('is_logged_in');
        $this->load->helper('form');
    }
     
function tabla_reporte($tit)
{
   $nivel= $this->session->userdata('nivel');
    $sql="select a.*,b.nombre as sucx,c.completo 
    from compras.reporte_c a 
    left join catalogo.sucursal b on b.suc=a.suc
    left join catalogo.cat_empleado c on c.nomina=a.solicita and c.tipo=1
    where a.tipo='A'";
	  	$query = $this->db->query($sql);
    	
	    
$tabla= "
        <table border=\"1\">
        <thead>
        <tr>
        <th colspan=\"7\" align=\"center\"><strong>$tit</strong></th>
        </tr>
        <tr>
        <th><strong>Departamento</strong></th>
        <th><strong>Solicita</strong></th>
        <th><strong>Peticion</strong></th>
       </tr>
        </thead>
        ";
        $num=0;
        foreach($query->result() as $row)
        {
 $l1 = anchor('sistemas/tabla_reporte_detalle/'.$row->id, '<img src="'.base_url().'img/icon_list_style_arrow.png" border="0" width="20px" /></a>', array('title' => 'Haz Click aqui para editar detalle !', 'class' => 'encabezado'));; 
 $l2 = anchor('sistemas/reporte_borrar/'.$row->id, '<img src="'.base_url().'img/error.png" border="0" width="20px" /></a>', array('title' => 'Haz Click aqui para borrar !', 'class' => 'encabezado'));;
           $tabla.="
            <tr bgcolor=\"#F4ECEC\">
            
            <td align=\"left\">".$row->sucx."<br />".$l2."</td>
            <td align=\"left\">".$row->completo."</td>
            <td align=\"left\"> ".$row->problema."</td>
            <td align=\"left\">".$l1."</td>
            
            </tr>
            ";
$num=$num+1;
        }
$tabla.="
<tr>
<td colspan=\"7\"><strong>TOTAL DE REPORTES:".number_format($num,0)."</strong></td>
</tr> 
</table>";
        
        
        return $tabla;

}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function busca_reporte($id,$tit)
{
   $nivel= $this->session->userdata('nivel');
    $sql="select a.*,b.nombre as sucx,c.completo ,c.puestox
    from compras.reporte_c a 
    left join catalogo.sucursal b on b.suc=a.suc
    left join catalogo.cat_empleado c on c.nomina=a.solicita and c.tipo=1
    where a.tipo='A'";
	  	$query = $this->db->query($sql);
    	
	    
$tabla= "
        <table border=\"1\">
        <thead>
        <tr>
        <th colspan=\"2\" align=\"center\"><strong>$tit</strong></th>
        </tr>
        </thead>
        ";
        $num=0;
        foreach($query->result() as $row)
        {
           $tabla.="
            <tr>
            <td align=\"left\">Departamento</td>
            <td align=\"left\">".$row->sucx."</td>
            </tr>
            <tr>
            <td align=\"left\">Solicitante</td>
            <td align=\"left\">".$row->completo."<br />".$row->puestox."</td>
            </tr>
            <tr>
            <td align=\"left\">Peticion</td>
            <td align=\"left\">".$row->problema."</td>
            </tr>
            
            ";
$num=$num+1;
        }
$tabla.="

</table>";
        
        
        return $tabla;

}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////
   function busca_nominaa($suc)
    {
    $sql = "SELECT nomina, completo FROM CATALOGO.cat_empleado where succ=$suc and tipo=1";
        $query = $this->db->query($sql);
        $tabla = "<option value=\"-\">Seleccione Personal</option>";
        
        foreach($query->result() as $row)
        {

            $tabla.="
            <option value =\"".$row->nomina."\">".$row->completo." - ".$row->nomina."</option>
            ";
        }
        
        return $tabla; 
    }
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////
   function busca_sis()
    {
    $sql = "SELECT nomina, completo FROM CATALOGO.cat_empleado where succ=90028 and tipo=1";
        $query = $this->db->query($sql);
        $tabla = "<option value=\"-\">Seleccione Personal</option>";
        
        foreach($query->result() as $row)
        {

            $tabla.="
            <option value =\"".$row->nomina."\">".$row->completo." - ".$row->nomina."</option>
            ";
        }
        
        return $tabla; 
    }

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function agrega_member_reporte($suc,$nomina,$problema)
{
    $new_member_insert_data = array(
            'suc'   =>$suc,
            'solicita'=>$nomina,
            'solucion'=>' ',
            'antes'=>' ',
            'ahora'=>' ',
            'problema'=>$problema
            
		);
		$insert = $this->db->insert('compras.reporte_c', $new_member_insert_data);
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function borrar_member_reporte($id)
{
        $datac = array('tipo'=>'X');
		$this->db->where('id', $id);
        $this->db->update('compras.reporte_c', $datac);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//**************************************************************
//**************************************************************
//**************************************************************
//**************************************************************
}